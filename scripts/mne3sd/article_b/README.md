# Article B Mobility Experiments

This directory collects the scripts used to reproduce the mobility-focused experiments that feed the "Article B" study of the MNE3SD campaign. The suite is organised around a small set of canonical mobility scenarios and the post-processing utilities required to transform the raw simulator output into camera-ready figures.

## Mobility scenarios

All scenarios simulate end-to-end LoRaWAN links with identical PHY parameters (SF10, 125 kHz bandwidth, coding rate 4/5) and an adaptive transmission interval that is recomputed after each successful delivery. The scenarios differ in the spatial layout and motion profiles of the mobile node fleet:

### `urban_canyon`
- **Environment**: Dense city blocks with 30 m street canyons and base stations mounted 25 m above ground.
- **Node population**: 120 pedestrian trackers.
- **Distance range**: 0.2 km to 2.5 km from the gateway, sampled uniformly along the street graph.
- **Velocity profile**: Pedestrian speed drawn from a Gaussian distribution with a mean of 1.4 m/s and a standard deviation of 0.4 m/s (clipped to the \[0.5, 2.5\] m/s interval).
- **Doppler handling**: Channel coherence updated every 3 seconds to capture fast fading caused by intersections.

### `rural_highway`
- **Environment**: 8 km highway segment with sparse roadside gateways installed every 2 km.
- **Node population**: 40 vehicle trackers moving along predefined lanes.
- **Distance range**: 0.5 km to 6 km line-of-sight paths with occasional obstructed sections (20% NLOS probability).
- **Velocity profile**: Triangular distribution peaking at 27 m/s with a support of \[15, 35\] m/s to reflect varying traffic conditions.
- **Handover model**: Nodes reassociate to the strongest gateway whenever the reference signal strength drops below -115 dBm for more than 5 seconds.

### `industrial_campus`
- **Environment**: 1.5 km × 1.0 km industrial site with metallic obstacles and three indoor gateways.
- **Node population**: 75 asset trackers alternating between indoor (60%) and outdoor (40%) areas.
- **Distance range**: 50 m to 1.8 km with a bimodal distribution favouring short-haul indoor hops.
- **Velocity profile**: Piecewise constant speeds sampled from \[0.1, 1.8\] m/s to model forklifts and personnel.
- **Shadowing**: Log-normal shadowing with a standard deviation of 8 dB applied indoors and 4 dB outdoors.

Each scenario script stores derived parameters (e.g. propagation exponent, retry backoff) inside module-level constants to keep the CLI interface focused on reproducible inputs.

## Simulation parameters

Scenario entry points expose the following command-line flags:

- `--config`: Optional path to a custom simulator configuration file. Defaults to `config.ini`.
- `--seed`: Base random seed applied to the simulator. Every repeated run increments the seed internally to ensure reproducible Monte Carlo batches.
- `--runs`: Number of Monte Carlo repetitions. Default: `20` for pedestrians (`urban_canyon`, `industrial_campus`), `10` for vehicles (`rural_highway`).
- `--duration`: Simulation horizon in seconds. Defaults to `7200` seconds.
- `--distance-min` / `--distance-max`: Override the minimum and maximum link distances. When omitted the ranges listed above are used.
- `--speed-min` / `--speed-max`: Override the admissible speed interval used by the scenario-specific random generators.
- `--output`: Target CSV file under `results/mne3sd/article_b/`.

Scenario modules may offer additional flags (for instance, toggling gateway diversity or adjusting traffic load). Document such options in the module docstrings.

## Plotting utilities

Plot modules are thin wrappers that aggregate CSV files produced by the scenarios and render the figures used in Article B. The shared CLI accepts:

- `--input`: One or more CSV files generated by the scenario scripts. Repeat the flag to process multiple datasets.
- `--figures-dir`: Destination directory for the exported figures. Defaults to `figures/mne3sd/article_b/`.
- `--format`: Output format (`png`, `pdf`, `svg`, ...). The default is `pdf`.
- `--style`: Optional Matplotlib style sheet applied before rendering (default: `figures/matplotlib-paper.mplstyle` when available).

## Directory structure

```
scripts/mne3sd/article_b/
├── README.md                # This guide
├── __init__.py              # Package marker for shared helpers
├── scenarios/               # Scenario entry points
│   └── __init__.py
└── plots/                   # Plotting entry points
    └── __init__.py
```

## Expected outputs

### CSV artefacts
All raw simulation data and aggregated metrics belong in `results/mne3sd/article_b/`. Use descriptive file names such as `urban_canyon_runs.csv` or `rural_highway_summary.csv`. When a scenario emits multiple files (e.g. per-gateway metrics and per-node traces) create a subdirectory: `results/mne3sd/article_b/industrial_campus/gateway_load.csv`.

Each CSV must include, at minimum, the following columns to support the downstream plotting pipeline:

- `scenario`: Name of the scenario module (e.g. `urban_canyon`).
- `run`: Monte Carlo repetition index starting at 0.
- `distance_m`: Instantaneous transmitter-receiver distance.
- `speed_mps`: Node speed at the sampling instant.
- `snr_db`, `rssi_dbm`: Channel quality indicators.
- `latency_s`, `delivery_ratio`: Key performance indicators used in the Article B figures.

### Figure artefacts
Export figures under `figures/mne3sd/article_b/`, keeping filenames aligned with the manuscript numbering (e.g. `figure_3_latency_vs_speed.pdf`). Place temporary debugging plots inside a dedicated subfolder such as `figures/mne3sd/article_b/debug/` to avoid mixing them with publication-ready outputs.

## Running the pipeline

All commands must be executed from the repository root. Replace `<scenario_module>` with the scenario file name (without the `.py` suffix) and `<figure_module>` with the plot module you want to run.

### Generate simulation data

```
python -m scripts.mne3sd.article_b.scenarios.<scenario_module> \
    --runs 20 \
    --duration 7200 \
    --seed 123 \
    --output results/mne3sd/article_b/<scenario_name>.csv
```

To sweep over distance or speed ranges use `--distance-min`, `--distance-max`, `--speed-min`, and `--speed-max`. Scenario modules may expose additional flags (for instance `--handover-threshold` in `rural_highway`); consult the module docstring for details.

### Generate figures

```
python -m scripts.mne3sd.article_b.plots.<figure_module> \
    --input results/mne3sd/article_b/<scenario_name>.csv \
    --figures-dir figures/mne3sd/article_b/ \
    --format pdf
```

Repeat the `--input` flag to combine multiple datasets in a single figure. Use `--style` to ensure all figures share the publication layout.

### Full workflow

1. Run every required scenario script until `results/mne3sd/article_b/` is populated with the expected CSV files.
2. Inspect the outputs to confirm that the distance and speed ranges reflect the desired configuration.
3. Launch the plotting modules to generate the final figures under `figures/mne3sd/article_b/`.
4. Review the exported figures locally before integrating them into the manuscript.

### Batch execution helper

You can launch the entire Article B pipeline with a single command using `scripts/mne3sd/run_all_article_outputs.py`:

```
python -m scripts.mne3sd.run_all_article_outputs --article b
```

This orchestrates every `run_mobility_*` scenario followed by the associated `plot_*` modules and finishes by printing the list of generated CSV files and figures. Combine it with `--skip-scenarios` or `--skip-plots` when you need to refresh only part of the workflow.

Keep this README in sync with the implemented scripts as additional scenarios or plots are added.
